dte build system
================

This directory contains the [GNU Make] based build system for `dte`,
along with various scripts used during compilation.

[`build.mk`] is probably the file you're looking for.

Includes
--------

The [main makefile] includes several other ([non-recursive]) makefiles.
The purpose of separating things like this is simply to make the build
system more manageable for maintainers and less overwhelming for casual
readers.

* [`build.mk`]\: Everything related to compiling and testing the editor
* [`docs.mk`]\: Recipes for generating HTML, roff (man page) and PDF
  documentation (using [Pandoc])
* [`gen.mk`]\: Updates the [Unicode search tables] from Unicode
  character database files
* [`util.mk`]\: General purpose utility variables
* [`help.mk`]\: Prints build system help info (`make help`) and
  variable debugging info (`make vars`, `make vvars`)
* [`compat.mk`]\: Ensures minimum requirements for [`$(MAKE_VERSION)`]
  and [`$(.FEATURES)`] are satisfied
* [`prelude.mk`]\: Includes other makefiles, but done in a way that's
  too ugly to be the first thing seen in [`GNUmakefile`]

Generated Includes
------------------

In addition to the non-generated makefiles mentioned above, [`prelude.mk`]
and [`build.mk`] also include several [generated makefiles]\:

* `build/gen/platform.mk`: Platform-specific variables; re-generated
  if any of the following are changed:
  * The [`platform.sh`] script that generates the makefile
  * The [`nproc.sh`] script used by [`platform.sh`]
* `build/gen/compiler.mk`: Variables for compiler-specific options;
  re-generated if any of the following are changed:
  * The [`compiler.sh`] script that generates the makefile
  * The contents of the `$(CC)` variable
  * The version string that `$(CC)` outputs (`$(CC_VERSION)`, as stored
    in `build/gen/cc-version.txt`)
* `build/**.mk` files with a matching `build/**.o`: [Generated dependency]
  info for object files; re-generated by the compiler every time the
  corresponding object is updated

There are several other generated files used to represent non-file
dependencies, but they're typically just stored as free-form text and
not included as makefiles. The `cc-version.txt` file mentioned above
is one such example.

Handling dependencies comprehensively like this ensures that `make`
always rebuilds targets when any of their inputs change and mostly
eliminates the need to call `make clean` (as often seen in simpler
build systems).

See Also
--------

* [`feature-test/README.md`]
* [`optcheck.sh`]
* `make help`
* [Rationale] for naming the [main makefile] `GNUmakefile`


[GNU Make]: https://www.gnu.org/software/make/
[non-recursive]: https://aegis.sourceforge.net/auug97.pdf
[Pandoc]: https://pandoc.org/
[`$(MAKE_VERSION)`]: https://www.gnu.org/software/make/manual/make.html#index-MAKE_005fVERSION
[`$(.FEATURES)`]: https://www.gnu.org/software/make/manual/make.html#index-_002eFEATURES-_0028list-of-supported-features_0029
[generated makefiles]: https://www.gnu.org/software/make/manual/make.html#index-prerequisites_002c-automatic-generation:~:text=make%20will%20try%20to%20remake%20any%20that%20are%20out%20of%20date%20or%20don%E2%80%99t%20exist
[Generated dependency]: https://www.gnu.org/software/make/manual/make.html#Automatic-Prerequisites
[Rationale]: https://www.gnu.org/software/make/manual/make.html#Makefile-Names:~:text=You%20should%20use%20this%20name%20if%20you%20have%20a%20makefile%20that%20is%20specific%20to%20GNU%20make

[main makefile]: ../GNUmakefile
[`GNUmakefile`]: ../GNUmakefile
[`build.mk`]: build.mk
[`compat.mk`]: compat.mk
[`docs.mk`]: docs.mk
[`gen.mk`]: gen.mk
[`help.mk`]: help.mk
[`prelude.mk`]: prelude.mk
[`util.mk`]: util.mk
[Unicode search tables]: ../src/util/unidata.h
[`platform.sh`]: platform.sh
[`nproc.sh`]: nproc.sh
[`compiler.sh`]: compiler.sh
[`feature-test/README.md`]: feature-test/README.md
[`optcheck.sh`]: optcheck.sh
