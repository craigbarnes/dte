language: c
sudo: false
git: {depth: false}
os: [linux, osx]
arch: [amd64, arm64, ppc64le, s390x]
compiler: [clang, gcc]

addons:
    homebrew:
        taps: homebrew/dupes
        packages: [make]

script:
    - git fetch --tags
    - export MAKE="$(command -v gmake || command -v make)"
    - export MAKEFLAGS="-j$(mk/nproc.sh)" DEBUG=3 WERROR=1 V=1
    - $MAKE vars
    - $MAKE check
    - ./dte -V
    - $MAKE check TERMINFO_DISABLE=1
    - $MAKE distcheck
